{"version":3,"file":"helpers.js","sourceRoot":"","sources":["../../src/helpers.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAC;AACtC,OAAO,EAAE,MAAM,EAAE,MAAM,WAAW,CAAC;AAEnC,MAAM,OAAO,OAAO;IAKlB,MAAM,CAAC,YAAY,CAAC,aAAoC,EAAE,YAAmC;QAC3F,IAAI,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC5C,IAAI,GAAG,CAAC;QAER,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC1C,GAAG,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;YAEpB,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;gBACrC,YAAY,CAAC,GAAG,CAAC,GAAG,aAAa,CAAC,GAAG,CAAC,CAAC;aACxC;SACF;QAED,OAAO,YAAY,CAAC;IACtB,CAAC;IAED,MAAM,CAAC,wBAAwB,CAAC,IAAc,EAAE,KAAU,EAAE,qBAA6B;QACvF,IAAI,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,QAAQ,EAAE;YACxC,MAAM,IAAI,KAAK,CAAC,qBAAqB,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAChE;QAED,KAAK,GAAG,KAAK,CAAC,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;QAEnC,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;YAC9B,MAAM,IAAI,KAAK,CAAC,qBAAqB,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAChE;QAED,OAAO,KAAK,CAAC;IACf,CAAC;IAED,MAAM,CAAC,uBAAuB,CAAC,GAAQ,EAAE,eAAoB,EAAE,qBAA6B;QAC1F,IAAI,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,QAAQ,EAAE;YACtC,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;SACxC;QAED,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAE5B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpC,IAAI,eAAe,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE;gBAClE,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;aACxC;SACF;QAED,OAAO,GAAG,CAAC;IACb,CAAC;IAED,MAAM,CAAC,eAAe,CAAC,MAAW;QAChC,OAAO,IAAI,CAAC,wBAAwB,CAClC,IAAI,CAAC,gBAAgB,EACrB,MAAM,EACN,QAAQ,CAAC,mBAAmB,CAC7B,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,iBAAiB,CAAC,IAAS;QAChC,OAAO,IAAI,CAAC,wBAAwB,CAClC,IAAI,CAAC,kBAAkB,EACvB,IAAI,EACJ,QAAQ,CAAC,qBAAqB,CAC/B,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,eAAe,CAAC,UAAe;QACpC,OAAO,IAAI,CAAC,wBAAwB,CAClC,IAAI,CAAC,gBAAgB,EACrB,UAAU,EACV,QAAQ,CAAC,uBAAuB,CACjC,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,4BAA4B,CAAC,GAAW;QAC7C,IAAI,GAAG,CAAC,WAAW,EAAE,KAAK,QAAQ,EAAE;YAClC,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,4BAA4B,CAAC,CAAC;SACxD;QAED,OAAO,GAAG,CAAC;IACb,CAAC;IAED,MAAM,CAAC,0BAA0B,CAAC,KAAU;QAC1C,IAAI,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,QAAQ,EAAE;YACxC,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,qBAAqB,CAAC,CAAC;SACjD;QAED,OAAO,KAAK,CAAC;IACf,CAAC;IAED,MAAM,CAAC,iBAAiB,CAAC,OAAY;QACnC,IAAI,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,QAAQ,IAAI,OAAO,GAAG,CAAC,EAAE;YACzD,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,qBAAqB,CAAC,CAAC;SACjD;QAED,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,MAAM,CAAC,wBAAwB,CAAC,MAAW;QACzC,IAAI,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,SAAS,EAAE;YAC1C,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,6BAA6B,CAAC,CAAC;SACzD;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,MAAM,CAAC,kBAAkB,CAAC,OAAY;QACpC,OAAO,IAAI,CAAC,uBAAuB,CAAC,OAAO,EAAE,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,qBAAqB,CAAC,CAAC;IAC3F,CAAC;IAED,MAAM,CAAC,iBAAiB,CAAC,MAAW;QAClC,OAAO,IAAI,CAAC,uBAAuB,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAE,QAAQ,CAAC,oBAAoB,CAAC,CAAC;IAClG,CAAC;IAED,MAAM,CAAC,sBAAsB,CAAC,GAAW,EAAE,WAAkC;QAC3E,IAAI,OAAO,GAAG,GAAG,CAAC,KAAK,CAAC,sCAAsC,CAAC,CAAC;QAChE,IAAI,MAAM,GAAQ,OAAO,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC;QAExC,OAAO,WAAW,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC;IACrC,CAAC;IAED,MAAM,CAAC,gBAAgB,CACrB,GAAW,EACX,cAAqC,EACrC,iBAAwC;QAExC,IAAI,aAAa,GAAG,iBAAiB,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;QACjD,IAAI,WAAW,GAAG,IAAI,CAAC,sBAAsB,CAAC,GAAG,EAAE,iBAAiB,CAAC,IAAI,EAAE,CAAC;QAC5E,IAAI,aAAa,GAAG,IAAI,CAAC,YAAY,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC;QAElE,aAAa,GAAG,IAAI,CAAC,YAAY,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;QAEjE,OAAO,aAAa,CAAC;IACvB,CAAC;IAED,MAAM,CAAC,mBAAmB,CAAC,cAAsB;QAC/C,QAAQ,cAAc,EAAE;YACtB,KAAK,MAAM;gBACT,OAAO,CAAC,QAAQ,CAAC,CAAC;YACpB,KAAK,YAAY;gBACf,OAAO,CAAC,QAAQ,CAAC,CAAC;YACpB;gBACE,OAAO,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;SAC9B;IACH,CAAC;IAED,MAAM,CAAC,gBAAgB,CAAC,IAAS,EAAE,cAAmB;QACpD,IAAI,eAAe,GAAG,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QAC7C,IAAI,gBAAgB,GAAG,IAAI,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC;QAEhE,IAAI,gBAAgB,CAAC,OAAO,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,EAAE;YACpD,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,kBAAkB,GAAG,GAAG,GAAG,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAClF;QAED,IAAI,cAAc,KAAK,MAAM,EAAE;YAC7B,IAAI,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;SACvB;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAED,MAAM,CAAC,sBAAsB,CAAC,SAAc,EAAE,MAAW;QACvD,IAAI,SAAS,KAAK,SAAS,EAAE;YAC3B,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;SAC7C;QAED,IAAI,MAAM,KAAK,SAAS,EAAE;YACxB,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;SAC1C;IACH,CAAC;IAED,MAAM,CAAC,oBAAoB,CAAC,OAA8B,EAAE,OAAY;QACtE,OAAO,GAAG,OAAO,IAAI,EAAE,CAAC;QAExB,OAAO;YACL,MAAM,EAAE,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,MAAM,IAAI,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;YACxE,YAAY,EAAE,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,YAAY,IAAI,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;YACxF,UAAU,EAAE,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,UAAU,CAAC;YAC1E,OAAO,EAAE,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC;YACnE,cAAc,EAAE,IAAI,CAAC,wBAAwB,CAC3C,OAAO,CAAC,cAAc,IAAI,OAAO,CAAC,cAAc,CACjD;YACD,OAAO,EAAE,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,OAAO,IAAI,EAAE,CAAC;YACvD,MAAM,EAAE,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,MAAM,IAAI,EAAE,CAAC;YACpD,IAAI,EAAE,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI;YAC1E,QAAQ,EAAE,OAAO,CAAC,QAAQ,IAAI,EAAE;YAChC,IAAI,EAAE,OAAO,CAAC,IAAI,IAAI,EAAE;SACzB,CAAC;IACJ,CAAC;;AA3LM,wBAAgB,GAAG,CAAC,YAAY,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;AAClD,wBAAgB,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAC;AAC3F,0BAAkB,GAAG,CAAC,MAAM,EAAE,aAAa,EAAE,MAAM,CAAC,CAAC","sourcesContent":["import { messages } from './messages';\nimport { jsUtil } from './js-util';\n\nexport class helpers {\n  static validSerializers = ['urlencoded', 'json', 'utf8'];\n  static validHttpMethods = ['get', 'put', 'post', 'patch', 'head', 'delete', 'upload', 'download'];\n  static validResponseTypes = ['text', 'arraybuffer', 'blob'];\n\n  static mergeHeaders(globalHeaders: { [id: string]: any }, localHeaders: { [id: string]: any }) {\n    var globalKeys = Object.keys(globalHeaders);\n    var key;\n\n    for (var i = 0; i < globalKeys.length; i++) {\n      key = globalKeys[i];\n\n      if (!localHeaders.hasOwnProperty(key)) {\n        localHeaders[key] = globalHeaders[key];\n      }\n    }\n\n    return localHeaders;\n  }\n\n  static checkForValidStringValue(list: string[], value: any, onInvalidValueMessage: string) {\n    if (jsUtil.getTypeOf(value) !== 'String') {\n      throw new Error(onInvalidValueMessage + ' ' + list.join(', '));\n    }\n\n    value = value.trim().toLowerCase();\n\n    if (list.indexOf(value) === -1) {\n      throw new Error(onInvalidValueMessage + ' ' + list.join(', '));\n    }\n\n    return value;\n  }\n\n  static checkKeyValuePairObject(obj: any, allowedChildren: any, onInvalidValueMessage: string) {\n    if (jsUtil.getTypeOf(obj) !== 'Object') {\n      throw new Error(onInvalidValueMessage);\n    }\n\n    var keys = Object.keys(obj);\n\n    for (var i = 0; i < keys.length; i++) {\n      if (allowedChildren.indexOf(jsUtil.getTypeOf(obj[keys[i]])) === -1) {\n        throw new Error(onInvalidValueMessage);\n      }\n    }\n\n    return obj;\n  }\n\n  static checkHttpMethod(method: any) {\n    return this.checkForValidStringValue(\n      this.validHttpMethods,\n      method,\n      messages.INVALID_HTTP_METHOD,\n    );\n  }\n\n  static checkResponseType(type: any) {\n    return this.checkForValidStringValue(\n      this.validResponseTypes,\n      type,\n      messages.INVALID_RESPONSE_TYPE,\n    );\n  }\n\n  static checkSerializer(serializer: any) {\n    return this.checkForValidStringValue(\n      this.validSerializers,\n      serializer,\n      messages.INVALID_DATA_SERIALIZER,\n    );\n  }\n\n  static checkForBlacklistedHeaderKey(key: string) {\n    if (key.toLowerCase() === 'cookie') {\n      throw new Error(messages.ADDING_COOKIES_NOT_SUPPORTED);\n    }\n\n    return key;\n  }\n\n  static checkForInvalidHeaderValue(value: any) {\n    if (jsUtil.getTypeOf(value) !== 'String') {\n      throw new Error(messages.INVALID_HEADERS_VALUE);\n    }\n\n    return value;\n  }\n\n  static checkTimeoutValue(timeout: any) {\n    if (jsUtil.getTypeOf(timeout) !== 'Number' || timeout < 0) {\n      throw new Error(messages.INVALID_TIMEOUT_VALUE);\n    }\n\n    return timeout;\n  }\n\n  static checkFollowRedirectValue(follow: any) {\n    if (jsUtil.getTypeOf(follow) !== 'Boolean') {\n      throw new Error(messages.INVALID_FOLLOW_REDIRECT_VALUE);\n    }\n\n    return follow;\n  }\n\n  static checkHeadersObject(headers: any) {\n    return this.checkKeyValuePairObject(headers, ['String'], messages.INVALID_HEADERS_VALUE);\n  }\n\n  static checkParamsObject(params: any) {\n    return this.checkKeyValuePairObject(params, ['String', 'Array'], messages.INVALID_PARAMS_VALUE);\n  }\n\n  static getMatchingHostHeaders(url: string, headersList: { [id: string]: any }) {\n    var matches = url.match(/^https?\\:\\/\\/([^\\/?#]+)(?:[\\/?#]|$)/i);\n    var domain: any = matches && matches[1];\n\n    return headersList[domain] || null;\n  }\n\n  static getMergedHeaders(\n    url: string,\n    requestHeaders: { [id: string]: any },\n    predefinedHeaders: { [id: string]: any },\n  ) {\n    var globalHeaders = predefinedHeaders['*'] || {};\n    var hostHeaders = this.getMatchingHostHeaders(url, predefinedHeaders) || {};\n    var mergedHeaders = this.mergeHeaders(globalHeaders, hostHeaders);\n\n    mergedHeaders = this.mergeHeaders(mergedHeaders, requestHeaders);\n\n    return mergedHeaders;\n  }\n\n  static getAllowedDataTypes(dataSerializer: string) {\n    switch (dataSerializer) {\n      case 'utf8':\n        return ['String'];\n      case 'urlencoded':\n        return ['Object'];\n      default:\n        return ['Array', 'Object'];\n    }\n  }\n\n  static getProcessedData(data: any, dataSerializer: any) {\n    var currentDataType = jsUtil.getTypeOf(data);\n    var allowedDataTypes = this.getAllowedDataTypes(dataSerializer);\n\n    if (allowedDataTypes.indexOf(currentDataType) === -1) {\n      throw new Error(messages.DATA_TYPE_MISMATCH + ' ' + allowedDataTypes.join(', '));\n    }\n\n    if (dataSerializer === 'utf8') {\n      data = { text: data };\n    }\n\n    return data;\n  }\n\n  static handleMissingCallbacks(successFn: any, failFn: any) {\n    if (successFn === undefined) {\n      throw new Error(messages.MANDATORY_SUCCESS);\n    }\n\n    if (failFn === undefined) {\n      throw new Error(messages.MANDATORY_FAIL);\n    }\n  }\n\n  static handleMissingOptions(options: { [id: string]: any }, globals: any) {\n    options = options || {};\n\n    return {\n      method: this.checkHttpMethod(options.method || this.validHttpMethods[0]),\n      responseType: this.checkResponseType(options.responseType || this.validResponseTypes[0]),\n      serializer: this.checkSerializer(options.serializer || globals.serializer),\n      timeout: this.checkTimeoutValue(options.timeout || globals.timeout),\n      followRedirect: this.checkFollowRedirectValue(\n        options.followRedirect || globals.followRedirect,\n      ),\n      headers: this.checkHeadersObject(options.headers || {}),\n      params: this.checkParamsObject(options.params || {}),\n      data: jsUtil.getTypeOf(options.data) === 'Undefined' ? null : options.data,\n      filePath: options.filePath || '',\n      name: options.name || '',\n    };\n  }\n}\n"]}